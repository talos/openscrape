{
    "description" : "A Caustic instruction",
    "id" : "#",
    "items": {
        "type" : [{ "$ref" : "#" }],
        "disallow" : "array"
    },
    "disallow": ["number", "boolean", "null"],
    "type" : [
        "string",
        "array",
        {
            "id": "#base",
            "description": "The basic permitted attributes of a Caustic instruction.",
            "additionalProperties": false,
            "properties": {
                "name" : {
                    "description" : "The name of this instruction.  If this is specified, its results will be saved under this name.  The results will also be used for substitutions using this name.",
                    "type" : "string",
                    "required" : false
                },
                "description" : {
                    "description" : "String description of this instruction.",
                    "type" : "string",
                    "required" : false
                },
                "metadata" : {
                    "description" : "An optional hash of metadata about this instruction.",
                    "type" : "object",
                    "required" : false
                },
                "then": {
                    "description" : "Caustic instruction(s) to run after this one is done.",
                    "required" : false,
                    "type": [{"$ref": "#"}]
                },
                "extends": {
                    "description" : "Caustic instruction(s) to inherit attributes from.",
                    "required" : false,
                    "type": [{"$ref": "#"}]
                }
            }
        },
        {
            "id": "#load",
            "description": "An instruction to load a page.",
            "type": "object",
            "extends": { "$ref" : "#base" },
            "properties": {
                "load": {
                    "description" : "The URL this instruction will load its result from.  Mustache substitutions are performed on this.",
                    "type" : "string",
                    "required" : false
                },
                "method" : {
                    "description" : "The HTTP method that should be used by this load.",
                    "type" : "string",
                    "enum" : ["head", "get", "post"],
                    "required" : false
                },
                "posts"   : {
                    "description" : "Post data for this load.  Can either be name-value pairs or a string.  Mustache substitutions are performed either way.",
                    "type" : ["object", "string"],
                    "required" : false
                },
                "headers" : {
                    "description" : "A set of name-value pairs that will be used as extra headers for this particular load.  Mustache substitutions are performed on both the name and value.",
                    "type" : "object",
                    "required" : false
                },
                "cookies": {
                    "description" : "A set of name-value pairs that will be used as extra cookies for this particular load.  Mustache substitutions are performed on both the name and value.",
                    "type" : "object",
                    "required" : false
                }
            }
        }, {
            "id": "#find",
            "description": "An instruction to locate a string in the parent's output.",
            "type" : "object",
            "extends": { "$ref" : "#base" },
            "properties": {
                "find": {
                    "description" : "The regular expression this instruction will use to find result(s) from its source.  Mustache substitutions are performed on this.",
                    "type" : "string",
                    "required" : false
                },
                "case_insensitive" : {
                    "description" : "Whether this pattern is case-sensitive.",
                    "type" : "boolean",
                    "required" : false,
                    "default" : false
                },
                "multiline" : {
                    "description" : "Whether ^ and $ should match at the start and end of each line.",
                    "type" : "boolean",
                    "required" : false,
                    "default" : false
                },
                "dot_matches_all" : {
                    "description" : "Whether . should match all characters, including newlines.",
                    "type" : "boolean",
                    "required" : false,
                    "default" : true
                },
                "replace" : {
                    "description" : "The replacement applied to each of the pattern's matches.  Backreferences from $0 to $9 can be used.  Mustache substitutions are applied.",
                    "type" : "string",
                    "default" : "$0",
                    "required" : false
                },
                "match" : {
                    "description" : "The index of a single find match to send to replace.  Exclusive of min and max.  0 is first and positive numbers count forwards; -1 is last and negative numbers count backwards.",
                    "type" : "integer",
                    "required" : false
                },
                "min" : {
                    "description" : "The index of the first find match to send to replace.  Exclusive of match.  0 is first and positive numbers count forwards; -1 is last and negative numbers count backwards.",
                    "type" : "integer",
                    "default" : 0,
                    "required" : false
                },
                "max" : {
                    "description" : "The index of the last match to send to replace.  Exclusive of min and max.  0 is first and positive numbers count forwards; -1 is last and negative numbers count backwards.",
                    "type" : "integer",
                    "default" : -1,
                    "required" : false
                }
            }
        }]
}

